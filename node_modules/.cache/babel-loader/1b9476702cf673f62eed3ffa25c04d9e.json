{"ast":null,"code":"/**\n * @fileOverview\n * @name aqicn-api.js\n * @author James Futhey <@kidGodzilla>\n * @license MIT\n */\nconst request = require('superagent');\n/**\n * Make a request to the Aqicn.org REST API to gather Air Quality data for a given city.\n *\n * @param {Object} configuration\n * @param {Function} callback\n * @api public\n */\n\n\nmodule.exports = function (conf, cb) {\n  const strings = {\n    en: {\n      0: {\n        min: 0,\n        max: 50,\n        label: 'Good',\n        implications: 'Air quality is considered satisfactory, and air pollution poses little or no risk',\n        precautions: 'None'\n      },\n      1: {\n        min: 51,\n        max: 100,\n        label: 'Moderate',\n        implications: 'Air quality is acceptable; however, for some pollutants there may be a moderate health concern for a very small number of people who are unusually sensitive to air pollution.',\n        precautions: 'Active children and adults, and people with respiratory disease, such as asthma, should limit prolonged outdoor exertion.'\n      },\n      2: {\n        min: 101,\n        max: 150,\n        label: 'Unhealthy for Sensitive Groups',\n        implications: 'Members of sensitive groups may experience health effects. The general public is not likely to be affected.',\n        precautions: 'Active children and adults, and people with respiratory disease, such as asthma, should limit prolonged outdoor exertion.'\n      },\n      3: {\n        min: 151,\n        max: 200,\n        label: 'Unhealthy',\n        implications: 'Everyone may begin to experience health effects; members of sensitive groups may experience more serious health effects.',\n        precautions: 'Active children and adults, and people with respiratory disease, such as asthma, should avoid prolonged outdoor exertion; everyone else, especially children, should limit prolonged outdoor exertion.'\n      },\n      4: {\n        min: 201,\n        max: 300,\n        label: 'Very Unhealthy',\n        implications: 'Health warnings of emergency conditions. The entire population is more likely to be affected.',\n        precautions: 'Active children and adults, and people with respiratory disease, such as asthma, should avoid all outdoor exertion; everyone else, especially children, should limit outdoor exertion.'\n      },\n      5: {\n        min: 300,\n        max: 500,\n        label: 'Hazardous',\n        implications: 'Health alert: everyone may experience more serious health effects.',\n        precautions: 'Everyone should avoid all outdoor exertion.'\n      }\n    },\n    cn: {\n      0: {\n        min: 0,\n        max: 50,\n        label: '优',\n        implications: '空气质量令人满意，基本无空气污染',\n        precautions: '各类人群可正常活动'\n      },\n      1: {\n        min: 51,\n        max: 100,\n        label: '良',\n        implications: '空气质量可接受，但某些污染物可能对极少数异常敏感人群健康有较弱影响',\n        precautions: '极少数异常敏感人群应减少户外活动'\n      },\n      2: {\n        min: 101,\n        max: 150,\n        label: '轻度污染',\n        implications: '易感人群症状有轻度加剧，健康人群出现刺激症状',\n        precautions: '儿童、老年人及心脏病、呼吸系统疾病患者应减少长时间、高强度的户外锻炼'\n      },\n      3: {\n        min: 151,\n        max: 200,\n        label: '中度污染',\n        implications: '进一步加剧易感人群症状，可能对健康人群心脏、呼吸系统有影响',\n        precautions: '儿童、老年人及心脏病、呼吸系统疾病患者避免长时间、高强度的户外锻炼，一般人群适量减少户外运动'\n      },\n      4: {\n        min: 201,\n        max: 300,\n        label: '重度污染',\n        implications: '心脏病和肺病患者症状显著加剧，运动耐受力降低，健康人群普遍出现症状',\n        precautions: '儿童、老年人及心脏病、肺病患者应停留在室内，停止户外运动，一般人群减少户外运动'\n      },\n      5: {\n        min: 300,\n        max: 500,\n        label: '严重污染',\n        implications: '健康人群运动耐受力降低，有明显强烈症状，提前出现某些疾病',\n        precautions: '儿童、老年人和病人应停留在室内，避免体力消耗，一般人群避免户外活动'\n      }\n    }\n  };\n  let {\n    lang = 'en',\n    city = 'beijing',\n    token = 'demo',\n    lat,\n    long\n  } = conf || {};\n  if (lat && long) city = `geo:${lat};${long}`;\n  let url = `https://api.waqi.info/feed/${city}/?token=`;\n  request.get(url + token).set('Content-Type', 'application/json').end((err, response) => {\n    if (!cb || typeof cb !== 'function') return console.error('Error: Callback is not a function.');\n    if (!response || !response.body) return cb('Error making API request');else if (!response.body.data) return cb(response.body);\n    let data = response.body.data; // Create a \"level\" from 0-5 representing the AQI\n\n    let level = Math.floor(data.aqi / 50);\n    if (level >= 5) level--;\n    data.level = Math.min(level, 5); // Normalize API response values\n\n    if (data.iaqi) for (var k in data.iaqi) {\n      try {\n        data[k] = data.iaqi[k].v;\n      } catch (e) {}\n    }\n\n    try {\n      if (data.time) data.time = data.time.v * 1000;\n    } catch (e) {}\n\n    if (data.city) {\n      try {\n        data.url = data.city.url;\n        data.geo = data.city.geo;\n        if (data.city.name) data.city = data.city.name;\n      } catch (e) {}\n    }\n\n    let attributions = data.attributions;\n    delete data.attributions;\n    delete data.debug;\n    delete data.iaqi; // Add strings\n\n    if (strings[lang][level]) data = Object.assign(data, strings[lang][level]);\n    data.attributions = attributions;\n    delete data.max;\n    delete data.min;\n    cb(data);\n  });\n};","map":{"version":3,"sources":["/Users/johnloberger/Flatiron/code/mod5/frontend/node_modules/aqicn-api/index.js"],"names":["request","require","module","exports","conf","cb","strings","en","min","max","label","implications","precautions","cn","lang","city","token","lat","long","url","get","set","end","err","response","console","error","body","data","level","Math","floor","aqi","iaqi","k","v","e","time","geo","name","attributions","debug","Object","assign"],"mappings":"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","sourcesContent":["/**\n * @fileOverview\n * @name aqicn-api.js\n * @author James Futhey <@kidGodzilla>\n * @license MIT\n */\nconst request = require('superagent');\n\n/**\n * Make a request to the Aqicn.org REST API to gather Air Quality data for a given city.\n *\n * @param {Object} configuration\n * @param {Function} callback\n * @api public\n */\nmodule.exports = function (conf, cb) {\n\n    const strings = {\n        en: {\n            0: {\n                min: 0,\n                max: 50,\n                label: 'Good',\n                implications: 'Air quality is considered satisfactory, and air pollution poses little or no risk',\n                precautions: 'None'\n            },\n            1: {\n                min: 51,\n                max: 100,\n                label: 'Moderate',\n                implications: 'Air quality is acceptable; however, for some pollutants there may be a moderate health concern for a very small number of people who are unusually sensitive to air pollution.',\n                precautions: 'Active children and adults, and people with respiratory disease, such as asthma, should limit prolonged outdoor exertion.'\n            },\n            2: {\n                min: 101,\n                max: 150,\n                label: 'Unhealthy for Sensitive Groups',\n                implications: 'Members of sensitive groups may experience health effects. The general public is not likely to be affected.',\n                precautions: 'Active children and adults, and people with respiratory disease, such as asthma, should limit prolonged outdoor exertion.'\n            },\n            3: {\n                min: 151,\n                max: 200,\n                label: 'Unhealthy',\n                implications: 'Everyone may begin to experience health effects; members of sensitive groups may experience more serious health effects.',\n                precautions: 'Active children and adults, and people with respiratory disease, such as asthma, should avoid prolonged outdoor exertion; everyone else, especially children, should limit prolonged outdoor exertion.'\n            },\n            4: {\n                min: 201,\n                max: 300,\n                label: 'Very Unhealthy',\n                implications: 'Health warnings of emergency conditions. The entire population is more likely to be affected.',\n                precautions: 'Active children and adults, and people with respiratory disease, such as asthma, should avoid all outdoor exertion; everyone else, especially children, should limit outdoor exertion.'\n            },\n            5: {\n                min: 300,\n                max: 500,\n                label: 'Hazardous',\n                implications: 'Health alert: everyone may experience more serious health effects.',\n                precautions: 'Everyone should avoid all outdoor exertion.'\n            }\n        },\n        cn: {\n            0: {\n                min: 0,\n                max: 50,\n                label: '优',\n                implications: '空气质量令人满意，基本无空气污染',\n                precautions: '各类人群可正常活动'\n            },\n            1: {\n                min: 51,\n                max: 100,\n                label: '良',\n                implications: '空气质量可接受，但某些污染物可能对极少数异常敏感人群健康有较弱影响',\n                precautions: '极少数异常敏感人群应减少户外活动'\n            },\n            2: {\n                min: 101,\n                max: 150,\n                label: '轻度污染',\n                implications: '易感人群症状有轻度加剧，健康人群出现刺激症状',\n                precautions: '儿童、老年人及心脏病、呼吸系统疾病患者应减少长时间、高强度的户外锻炼'\n            },\n            3: {\n                min: 151,\n                max: 200,\n                label: '中度污染',\n                implications: '进一步加剧易感人群症状，可能对健康人群心脏、呼吸系统有影响',\n                precautions: '儿童、老年人及心脏病、呼吸系统疾病患者避免长时间、高强度的户外锻炼，一般人群适量减少户外运动'\n            },\n            4: {\n                min: 201,\n                max: 300,\n                label: '重度污染',\n                implications: '心脏病和肺病患者症状显著加剧，运动耐受力降低，健康人群普遍出现症状',\n                precautions: '儿童、老年人及心脏病、肺病患者应停留在室内，停止户外运动，一般人群减少户外运动'\n            },\n            5: {\n                min: 300,\n                max: 500,\n                label: '严重污染',\n                implications: '健康人群运动耐受力降低，有明显强烈症状，提前出现某些疾病',\n                precautions: '儿童、老年人和病人应停留在室内，避免体力消耗，一般人群避免户外活动'\n            }\n        }\n    };\n\n    let { lang = 'en', city = 'beijing', token = 'demo', lat, long } = conf || {};\n    if (lat && long) city = `geo:${ lat };${ long }`;\n\n    let url = `https://api.waqi.info/feed/${ city }/?token=`;\n\n    request.get(url + token).set('Content-Type', 'application/json').end((err, response) => {\n\n        if (!cb || typeof cb !== 'function') return console.error('Error: Callback is not a function.');\n\n        if (!response || !response.body) return cb('Error making API request');\n        else if (!response.body.data) return cb(response.body);\n\n        let data = response.body.data;\n\n        // Create a \"level\" from 0-5 representing the AQI\n        let level = Math.floor(data.aqi / 50);\n        if (level >= 5) level--;\n        data.level = Math.min(level, 5);\n\n        // Normalize API response values\n        if (data.iaqi) for (var k in data.iaqi) {\n            try {\n                data[k] = data.iaqi[k].v;\n            } catch(e){}\n        }\n\n        try { if (data.time) data.time = data.time.v * 1000 } catch(e){}\n\n        if (data.city) {\n            try {\n                data.url = data.city.url;\n                data.geo = data.city.geo;\n                if (data.city.name) data.city = data.city.name;\n            } catch(e){}\n        }\n\n        let attributions = data.attributions;\n        delete data.attributions;\n        delete data.debug;\n        delete data.iaqi;\n\n        // Add strings\n        if (strings[lang][level]) data = Object.assign(data, strings[lang][level]);\n\n        data.attributions = attributions;\n        delete data.max;\n        delete data.min;\n\n        cb(data);\n    });\n\n};\n"]},"metadata":{},"sourceType":"script"}